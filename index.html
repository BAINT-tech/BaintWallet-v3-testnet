<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BAINT Wallet v3 — Testnet Demo</title>

  <!-- Simple minimal styling -->
  <style>
    :root{
      --bg: #ffffff;
      --card: #f8fbff;
      --muted: #6b7280;
      --accent: linear-gradient(90deg,#0b74ff,#7c3aed);
      --glass: rgba(11,19,40,0.03);
      --mono: #0f172a;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;}
    body{margin:0;background:var(--bg);color:var(--mono);min-height:100vh;display:flex;flex-direction:column}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 20px;border-bottom:1px solid #eef5ff;background:linear-gradient(180deg,#fff,#f8fbff)}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#ffd166,#f77f00);display:flex;align-items:center;justify-content:center;font-weight:900}
    .title{font-weight:800;font-size:18px}
    .controls{display:flex;gap:10px;align-items:center}
    select,input,button{font-family:inherit}
    .btn{background:transparent;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:800}
    .btn.primary{background:var(--accent);-webkit-background-clip:text;background-clip:text;color:transparent;padding:8px 14px;border-radius:10px;border:1px solid rgba(11,116,255,0.08);background-image:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:1px solid rgba(11,19,40,0.05);padding:8px 12px;border-radius:10px}
    main{max-width:1000px;margin:24px auto;display:grid;grid-template-columns:1fr 360px;gap:18px;padding:0 20px}
    .card{background:var(--card);padding:16px;border-radius:14px;border:1px solid rgba(11,19,40,0.03);box-shadow:0 8px 30px rgba(2,6,23,0.03)}
    h2{margin:0 0 10px 0}
    .mono{font-family:monospace;background:#fff;padding:8px;border-radius:8px;border:1px solid #eef5ff}
    .label{font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"], input[type="number"], select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(11,19,40,0.04);margin-top:6px}
    .grid{display:flex;gap:12px}
    .row{display:flex;gap:8px;align-items:center}
    .tx-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .tx-item{padding:10px;border-radius:10px;background:#fff;border:1px solid rgba(11,19,40,0.03);font-size:14px}
    footer{padding:14px;text-align:center;color:var(--muted);margin-top:auto}
    @media (max-width:900px){ main{grid-template-columns:1fr} .controls{flex-direction:column;align-items:flex-end} }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">B</div>
      <div>
        <div class="title">BAINT Wallet</div>
        <div style="font-size:12px;color:var(--muted)">Testnet Demo — Sepolia & BSC Testnet</div>
      </div>
    </div>

    <div class="controls">
      <select id="networkSelect" title="Switch network">
        <option value="auto">Detect (MetaMask)</option>
        <option value="sepolia">Sepolia (Ethereum)</option>
        <option value="bsc_testnet">BSC Testnet</option>
      </select>

      <button id="connectBtn" class="btn primary">Connect BAINT Wallet</button>
    </div>
  </header>

  <main>
    <section class="card">
      <h2>Wallet</h2>

      <div style="margin-bottom:12px">
        <div class="label">Address</div>
        <div id="addr" class="mono">—</div>
      </div>

      <div class="grid" style="margin-bottom:12px">
        <div>
          <div class="label">Network</div>
          <div id="networkName" class="mono">—</div>
        </div>
        <div>
          <div class="label">Native Balance</div>
          <div id="balance" class="mono">—</div>
        </div>
      </div>

      <hr style="margin:12px 0;border:0;border-top:1px solid #eef5ff" />

      <h3 style="margin:8px 0">Send Native Coin</h3>
      <div class="label">To</div>
      <input id="to" type="text" placeholder="Recipient address (0x...)" />
      <div class="label" style="margin-top:8px">Amount</div>
      <input id="amount" type="number" placeholder="e.g. 0.01" />
      <div class="row" style="margin-top:12px">
        <button id="sendBtn" class="btn primary">Send</button>
        <button id="mockRecvBtn" class="btn ghost">Add Mock Receive</button>
      </div>

      <div id="sendStatus" style="margin-top:12px;color:var(--muted)"></div>
    </section>

    <aside class="card">
      <h3>Transaction History</h3>
      <div id="txList" class="tx-list muted">No transactions yet</div>
      <div style="margin-top:12px" class="label">Notes</div>
      <div class="muted" style="font-size:13px">History is stored locally in your browser for demo purposes.</div>
    </aside>
  </main>

  <footer>BAINT Wallet • Demo v3 — do not use mainnet funds</footer>

  <!-- ethers v6 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>

  <!-- App script -->
  <script>
    // BAINT Wallet v3 — single page demo
    const PRESETS = {
      sepolia: { chainId: 11155111, hex: '0xaa36a7', name: 'Sepolia', rpc: '' },
      bsc_testnet: { chainId: 97, hex: '0x61', name: 'BSC Testnet', rpc: 'https://data-seed-prebsc-1-s1.binance.org:8545/' }
    };

    const STATE_KEY = 'baint_v3_demo_state';
    let state = { address: null, chainId: null, txs: [] };

    // UI refs
    const connectBtn = document.getElementById('connectBtn');
    const addrEl = document.getElementById('addr');
    const networkNameEl = document.getElementById('networkName');
    const balanceEl = document.getElementById('balance');
    const networkSelect = document.getElementById('networkSelect');
    const sendBtn = document.getElementById('sendBtn');
    const sendStatus = document.getElementById('sendStatus');
    const toInput = document.getElementById('to');
    const amountInput = document.getElementById('amount');
    const txListEl = document.getElementById('txList');
    const mockRecvBtn = document.getElementById('mockRecvBtn');

    // load/save
    function loadState(){ try{ const raw = localStorage.getItem(STATE_KEY); if(raw) state = JSON.parse(raw);}catch(e){} renderTxs(); }
    function saveState(){ localStorage.setItem(STATE_KEY, JSON.stringify(state)); }

    // helpers
    const short = (a)=> a ? a.slice(0,8) + '...' + a.slice(-6) : '—';
    function renderAccount(){ addrEl.textContent = state.address ? short(state.address) : '—'; networkNameEl.textContent = state.chainId ? (networkLabel(state.chainId)) : '—'; }
    function networkLabel(chainId){ if(chainId === PRESETS.sepolia.chainId) return 'Sepolia (ETH)'; if(chainId === PRESETS.bsc_testnet.chainId) return 'BSC Testnet'; return 'Unknown'; }

    async function connect() {
      if(!window.ethereum) { alert('MetaMask not found. Install MetaMask to test.'); return; }
      try {
        const provider = new ethers.BrowserProvider(window.ethereum);
        const accounts = await provider.send('eth_requestAccounts', []);
        const signer = await provider.getSigner();
        const address = accounts[0];
        const network = await provider.getNetwork();
        state.address = address;
        state.chainId = network.chainId;
        saveState();
        renderAccount();
        await refreshBalance();
        connectBtn.textContent = 'Connected';
        connectBtn.disabled = true;
        setupListeners();
      } catch (e) {
        console.error('Connect error', e);
        alert('Connection failed: ' + (e.message || e));
      }
    }

    async function refreshBalance(){
      if(!state.address) { balanceEl.textContent = '—'; return; }
      try {
        const provider = new ethers.BrowserProvider(window.ethereum);
        const bal = await provider.getBalance(state.address);
        // format with 6 decimals
        balanceEl.textContent = Number(ethers.formatEther(bal)).toFixed(6);
      } catch (e) {
        console.error('Balance error', e);
        balanceEl.textContent = '—';
      }
    }

    async function connectWalletAndSwitch(chain) {
  try {
    if (!window.ethereum) {
      alert("Please install MetaMask!");
      return;
    }

    const provider = new ethers.BrowserProvider(window.ethereum);
    await provider.send("eth_requestAccounts", []);

    // Switch network
    try {
      await window.ethereum.request({
        method: "wallet_switchEthereumChain",
        params: [{ chainId: networks[chain].chainId }],
      });
      console.log(`Switched to ${networks[chain].chainName}`);
    } catch (switchError) {
      // If the network is not added
      if (switchError.code === 4902) {
        await window.ethereum.request({
          method: "wallet_addEthereumChain",
          params: [networks[chain]],
        });
      } else {
        throw switchError;
      }
    }

    const signer = await provider.getSigner();
    const address = await signer.getAddress();
    console.log("Connected:", address);

  } catch (error) {
    console.error("Connection failed:", error);
  }
    }
      // refresh state
      const provider = new ethers.BrowserProvider(window.ethereum);
      const net = await provider.getNetwork();
      state.chainId = net.chainId;
      saveState();
      renderAccount();
      await refreshBalance();
    }

    async function sendNative(){
      if(!state.address) return alert('Connect wallet first');
      const to = toInput.value.trim();
      const amount = amountInput.value.trim();
      if(!to || !to.startsWith('0x') || !amount) return alert('Enter a valid recipient and amount');
      try {
        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        const tx = await signer.sendTransaction({ to, value: ethers.parseEther(amount) });
        sendStatus.textContent = 'Tx sent: ' + tx.hash;
        addTx({ type:'Send', to, amount, hash: tx.hash, time: Date.now() });
        await tx.wait();
        sendStatus.textContent = 'Confirmed: ' + tx.hash;
        await refreshBalance();
      } catch(e){
        console.error('Send error', e);
        sendStatus.textContent = 'Error: ' + (e.message || e);
      }
    }

    function addTx(tx){ state.txs = state.txs || []; state.txs.unshift(tx); if(state.txs.length>50) state.txs.pop(); saveState(); renderTxs(); }
    function renderTxs(){
      txListEl.innerHTML = '';
      if(!state.txs || state.txs.length===0){ txListEl.innerHTML = '<div class="muted">No transactions yet</div>'; return; }
      state.txs.forEach(t=>{
        const d = document.createElement('div'); d.className='tx-item';
        d.innerHTML = `<div><strong>${t.type}</strong> ${t.amount || ''} → ${t.to || ''}</div><div style="font-size:12px;color:${'var(--muted)'}">${new Date(t.time).toLocaleString()} ${t.hash? ' • ' + t.hash : ''}</div>`;
        txListEl.appendChild(d);
      });
    }

    // mock receive helper for testing UI
    function addMockReceive(){
      if(!state.address) return alert('Connect first');
      const tx = { type:'Receive', to: state.address, amount: (Math.random()*0.5).toFixed(5), hash:'mock_' + Math.random().toString(36).slice(2,9), time: Date.now() };
      addTx(tx);
      alert('Mock receive added to history (for UI testing)');
    }

    // persist and react to external wallet changes
    function setupListeners(){
      if(window.ethereum){
        window.ethereum.on('accountsChanged', (accs)=>{ state.address = accs && accs[0] ? accs[0] : null; saveState(); renderAccount(); refreshBalance(); });
        window.ethereum.on('chainChanged', async ()=>{ const provider=new ethers.BrowserProvider(window.ethereum); const net = await provider.getNetwork(); state.chainId = net.chainId; saveState(); renderAccount(); refreshBalance(); });
      }
    }

    // wiring
    connectBtn.addEventListener('click', connect);
    sendBtn.addEventListener('click', sendNative);
    mockRecvBtn.addEventListener('click', addMockReceive);
    networkSelect.addEventListener('change', async (e)=>{
      const v = e.target.value;
      if(v === 'auto') return; // user chooses to rely on metamask
      await switchTo(v);
    });

    // init
    loadState();
    renderAccount();
    refreshBalance();
  </script>
</body>
  </html>
